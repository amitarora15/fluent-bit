# **Fluent Bit Set Up**

This project contains the information to run fluent bit in docker and send the data to Open search and Kafka.

### Directory structure
<ul>
<li>config - contains all configuration for fluent bit:
    <ul>
        <li>fluent-bit.conf - main configuration file of fluent bit, defining SERVICE section and referencing input, output, filters and other files</li>
        <li>inputs.conf - contains tail INPUT plugin to listen log messages</li>
        <li>parsers.conf - contains multi line and regex to parse logs</li>
        <li>filters.conf - contains information for modifying logs</li>
        <li>log_modified.lua - lua script to add information using some logic</li>
        <li>outputs.conf - contains tag based routing to console and kafka</li>
    </ul>
</li>
<li>data - directory containing buffered data to handle back pressure</li>
<li>db - directory containing information for maintaining offset for forward pressure handling</li>
<li>log - directory where fluent-bit logs are generated</li>
<li>test-data - directory where logs are generated by python script</li>
<li>test-data-generator - python script to generate the data</li>
<li>docker-compose.yaml - docker compose file</li>
</ul>

### Assumptions
<ol>
<li>Python is installed</li>
<li>Docker is installed</li>
</ol>

### Execution
<ul>
<li>Go to Shell, navigate to project</li>
<li>Type </li>

```editorconfig
docker compose up
```
<li>You will notice that fluent-bit is getting downloaded and installed on your machine</li>
<li>Navigate to test-data-generator directory in other shell</li>

```editorconfig
python3 my_log_generator.py 
```
<li>Logs are getting generated and getting monitored and parsed by fluent-bit and passed to console or other downstream system like Kafka or Open search</li>
<li>Sample logs generated:</li>

```editorconfig
fluent-bit_1  | [1260] fluent_logs: [[1688923353.983504772, {}], {"log_time"=>"2023/07/09 17:22:33", "level"=>"debug", "plugin"=>"input:tail:fluent_logs", "message"=>"inode=71457592, /mnt/fluent-bit/log/fluent-bit.log, events: IN_MODIFY ", "filepath"=>"/mnt/fluent-bit/log/fluent-bit.log", "index_name"=>"fluent_log", "host"=>"9680adc64941"}]
fluent-bit_1  | [0] my_log: [[1688923352.359083414, {}], {"level"=>"ERROR", "message"=>"my new message", "host"=>"9680adc64941", "log_time"=>"12/02/2002T12:00:00", "index_name"=>"app_logs", "server"=>"server.com", "filepath"=>"/mnt/test-data/my_log.log"}]
```
